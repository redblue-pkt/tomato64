#!/bin/sh

set -e

. /usr/sbin/nvram_ops

if [ "$(NG set_macs)" == "0" ]; then

	for i in `ls /sys/class/net/`;
	do
		if [[ "$i" == "eth"* ]]; then
			NS ${i}macaddr=$(cat /sys/class/net/${i}/address | tr '[:lower:]' '[:upper:]')
		fi
	done

	if [ "$(NG wan_invert)" == "1" ]; then
		if [ -e /sys/class/net/eth0/address ]; then
			for i in wan_hwaddr wan_mac;
			do
				NS ${i}=`ifconfig eth0 | grep -o -E ..:..:..:..:..:..`
			done
		fi
	else
		if [ -e /sys/class/net/eth1/address ]; then
			for i in wan_hwaddr wan_mac;
			do
				NS ${i}=`ifconfig eth1 | grep -o -E ..:..:..:..:..:..`
			done
		fi
	fi

	NS set_macs=1
fi

if [ "$(NG wan_invert)" == "1" ]; then
	if [ "$(NG et0macaddr)" == "" ]; then
		NS et0macaddr=`ifconfig eth1 | grep -o -E ..:..:..:..:..:..`
	fi
else
	if [ "$(NG et0macaddr)" == "" ]; then
		NS et0macaddr=`ifconfig eth0 | grep -o -E ..:..:..:..:..:..`
	fi
fi
